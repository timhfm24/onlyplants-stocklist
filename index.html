<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>OnlyPlants Stocklist</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <select id="typeFilter" onchange="filter()">
    <option value="">Typ: Alle</option>
    <option>Steckling</option>
    <option>Pflanze</option>
  </select>
  <select id="statusFilter" onchange="filter()">
    <option value="">Status: Alle</option>
    <option value="verfügbar">Verfügbar</option>
    <option value="reserviert">Reserviert</option>
    <option value="vergeben">Vergeben</option>
  </select>
  <div class="hint">Kontakt per Instagram DM: <strong>@deinhandle</strong> · Privatabgabe, kein Gewerbe</div>
</header>

<main class="wrap">
  <ul class="plant-list" id="grid">
    <!-- Die Pflanzen werden hier per JS als <li> eingefügt -->
  </ul>
</main>

<footer>
  <div class="wrap">© <span id="year"></span> OnlyPlants · Privatverkauf (keine Gewährleistung)</div>
</footer>

<script>
const q = (id)=>document.getElementById(id);
const grid = q('grid');
document.getElementById('year').textContent = new Date().getFullYear();

// Pflanzen aus JSON laden und anzeigen
fetch('plants.json', { cache: 'no-store' })
  .then(r => r.json())
  .then(data => render(data))
  .catch(err => {
    grid.innerHTML = '<div>Fehler beim Laden der Stocklist.</div>';
    console.error(err);
  });

function render(plants) {
  grid.innerHTML = plants.map(p => plantListItem(p)).join('');
}

function plantListItem(p) {
  let type = p.category;
  type = type.charAt(0).toUpperCase() + type.slice(1);
  const status = 'verfügbar';
  const price = '—';
  return `<li class="plant-item" data-name="${escapeHTML(p.name)}" data-type="${type}" data-status="${status}">
    <div>
      <strong>${escapeHTML(p.name)}</strong>
      <div class="meta">${type}</div>
    </div>
    <span class="price">${price}</span>
    <span class="tag ok">${status}</span>
  </li>`;
}

function escapeHTML(s){
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
}

function filter(){
  const t = q('typeFilter').value;
  const st = q('statusFilter').value;
  for(const item of grid.children){
    const type = item.dataset.type.toLowerCase();
    const status = item.dataset.status;
    const match = (!t || type===t.toLowerCase()) && (!st || status===st);
    item.style.display = match ? '' : 'none';
  }
}
</script>
</body>
</html>
